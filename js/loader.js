// 真实资源加载进度统计(min)
(()=>{const cfg=window.__APP_CONFIG__||{};if(!cfg.enableSplash)return;const s=document.getElementById('splash');if(!s)return;const bar=s.querySelector('.splash-bar span'),ttl=s.querySelector('.splash-title');const res=[...document.querySelectorAll('link[rel="stylesheet"],link[rel="manifest"],script[defer]')].filter(el=>el.src||el.href);const urls=[...new Set(res.map(r=>r.src||r.href))];const total=urls.length||1;let loaded=0;const upd=()=>{loaded=Math.min(loaded,total);const p=Math.round(loaded/total*100);bar&&(bar.style.width=p+'%');ttl&&(ttl.textContent=p<100?'Loading '+p+'%':'Ready');};upd();urls.forEach(u=>{if(performance.getEntriesByName(u).some(e=>e.initiatorType)){loaded++;return upd();}const el=res.find(r=>(r.src||r.href)===u);if(!el){loaded++;return upd();}const done=()=>{loaded++;upd();cl();},err=()=>{loaded++;upd();cl();};function cl(){el.removeEventListener('load',done);el.removeEventListener('error',err);}el.addEventListener('load',done);el.addEventListener('error',err);});const ob=new MutationObserver(()=>{if(bar&&bar.style.width==='100%')ob.disconnect();});bar&&ob.observe(bar,{attributes:true,attributeFilter:['style']});})();
